{"version":3,"file":"referenceCountingCache.js","names":["each","debounce","createReferenceCountingCache","_ref","arguments","length","undefined","_ref$cleanupDelay","cleanupDelay","items","cleanup","item","key","refCount","get","getter","value","release"],"sources":["../../src/lib/referenceCountingCache.ts"],"sourcesContent":["import { each, debounce } from \"lodash\";\n\nexport default function createReferenceCountingCache({ cleanupDelay = 2000 } = {}) {\n  const items = {};\n\n  const cleanup = debounce(() => {\n    each(items, (item, key) => {\n      // @ts-expect-error ts-migrate(2339) FIXME: Property 'refCount' does not exist on type 'never'... Remove this comment to see the full error message\n      if (item.refCount <= 0) {\n        // @ts-expect-error ts-migrate(7053) FIXME: Element implicitly has an 'any' type because expre... Remove this comment to see the full error message\n        delete items[key];\n      }\n    });\n  }, cleanupDelay);\n\n  function get(key: any, getter: any) {\n    // @ts-expect-error ts-migrate(7053) FIXME: Element implicitly has an 'any' type because expre... Remove this comment to see the full error message\n    if (!items[key]) {\n      // @ts-expect-error ts-migrate(7053) FIXME: Element implicitly has an 'any' type because expre... Remove this comment to see the full error message\n      items[key] = {\n        value: getter(),\n        refCount: 0,\n      };\n    }\n    // @ts-expect-error ts-migrate(7053) FIXME: Element implicitly has an 'any' type because expre... Remove this comment to see the full error message\n    const item = items[key];\n    item.refCount += 1;\n    return item.value;\n  }\n\n  function release(key: any) {\n    // @ts-expect-error ts-migrate(7053) FIXME: Element implicitly has an 'any' type because expre... Remove this comment to see the full error message\n    if (items[key]) {\n      // @ts-expect-error ts-migrate(7053) FIXME: Element implicitly has an 'any' type because expre... Remove this comment to see the full error message\n      const item = items[key];\n      if (item.refCount > 0) {\n        item.refCount -= 1;\n        if (item.refCount <= 0) {\n          cleanup();\n        }\n      }\n    }\n  }\n\n  return { get, release };\n}\n"],"mappings":"AAAA,SAASA,IAAI,EAAEC,QAAQ,QAAQ,QAAQ;AAEvC,eAAe,SAASC,4BAA4BA,CAAA,EAA+B;EAAA,IAAAC,IAAA,GAAAC,SAAA,CAAAC,MAAA,QAAAD,SAAA,QAAAE,SAAA,GAAAF,SAAA,MAAJ,CAAC,CAAC;IAAAG,iBAAA,GAAAJ,IAAA,CAA1BK,YAAY;IAAZA,YAAY,GAAAD,iBAAA,cAAG,IAAI,GAAAA,iBAAA;EACxE,IAAME,KAAK,GAAG,CAAC,CAAC;EAEhB,IAAMC,OAAO,GAAGT,QAAQ,CAAC,MAAM;IAC7BD,IAAI,CAACS,KAAK,EAAE,CAACE,IAAI,EAAEC,GAAG,KAAK;MACzB;MACA,IAAID,IAAI,CAACE,QAAQ,IAAI,CAAC,EAAE;QACtB;QACA,OAAOJ,KAAK,CAACG,GAAG,CAAC;MACnB;IACF,CAAC,CAAC;EACJ,CAAC,EAAEJ,YAAY,CAAC;EAEhB,SAASM,GAAGA,CAACF,GAAQ,EAAEG,MAAW,EAAE;IAClC;IACA,IAAI,CAACN,KAAK,CAACG,GAAG,CAAC,EAAE;MACf;MACAH,KAAK,CAACG,GAAG,CAAC,GAAG;QACXI,KAAK,EAAED,MAAM,CAAC,CAAC;QACfF,QAAQ,EAAE;MACZ,CAAC;IACH;IACA;IACA,IAAMF,IAAI,GAAGF,KAAK,CAACG,GAAG,CAAC;IACvBD,IAAI,CAACE,QAAQ,IAAI,CAAC;IAClB,OAAOF,IAAI,CAACK,KAAK;EACnB;EAEA,SAASC,OAAOA,CAACL,GAAQ,EAAE;IACzB;IACA,IAAIH,KAAK,CAACG,GAAG,CAAC,EAAE;MACd;MACA,IAAMD,IAAI,GAAGF,KAAK,CAACG,GAAG,CAAC;MACvB,IAAID,IAAI,CAACE,QAAQ,GAAG,CAAC,EAAE;QACrBF,IAAI,CAACE,QAAQ,IAAI,CAAC;QAClB,IAAIF,IAAI,CAACE,QAAQ,IAAI,CAAC,EAAE;UACtBH,OAAO,CAAC,CAAC;QACX;MACF;IACF;EACF;EAEA,OAAO;IAAEI,GAAG;IAAEG;EAAQ,CAAC;AACzB"}