{"version":3,"file":"value-format.js","names":["React","ReactDOMServer","moment","numeral","isString","isArray","isUndefined","isFinite","isNil","toString","visualizationsSettings","options","scalePercentBy100","urlPattern","hasOwnProperty","Object","prototype","NullValueComponent","createElement","className","nullValue","createTextFormatter","highlightLinks","value","Link","LinkComponent","replace","unused","prefix","href","link","renderToStaticMarkup","target","rel","toMoment","isMoment","ISO_8601","RFC_2822","createDateTimeFormatter","format","wrapped","isValid","createBooleanFormatter","values","length","createNumberFormatter","canReturnHTMLElement","arguments","undefined","n","set","formatSimpleTemplate","str","data","match","prop","call"],"sources":["../../src/lib/value-format.tsx"],"sourcesContent":["import React from \"react\";\nimport ReactDOMServer from \"react-dom/server\";\nimport moment from \"moment/moment\";\nimport numeral from \"numeral\";\nimport { isString, isArray, isUndefined, isFinite, isNil, toString } from \"lodash\";\nimport { visualizationsSettings } from \"@/visualizations/visualizationsSettings\";\n\n\nnumeral.options.scalePercentBy100 = false;\n\n// eslint-disable-next-line\nconst urlPattern = /(^|[\\s\\n]|<br\\/?>)((?:https?|ftp):\\/\\/[\\-A-Z0-9+\\u0026\\u2019@#\\/%?=()~_|!:,.;]*[\\-A-Z0-9+\\u0026@#\\/%=~()_|])/gi;\n\nconst hasOwnProperty = Object.prototype.hasOwnProperty;\n\nfunction NullValueComponent() {\n  return <span className=\"display-as-null\">{visualizationsSettings.nullValue}</span>;\n}\n\nexport function createTextFormatter(highlightLinks: any) {\n  if (highlightLinks) {\n    return (value: any) => {\n      if (value === null) {\n        return <NullValueComponent/>\n      }\n      if (isString(value)) {\n        const Link = visualizationsSettings.LinkComponent;\n        value = value.replace(urlPattern, (unused, prefix, href) => {\n          const link = ReactDOMServer.renderToStaticMarkup(\n            <Link href={href} target=\"_blank\" rel=\"noopener noreferrer\">\n              {href}\n            </Link>\n          );\n          return prefix + link;\n        });\n      }\n      return toString(value);\n    };\n  }\n  return (value: any) => value === null ? <NullValueComponent/> : toString(value);\n}\n\nfunction toMoment(value: any) {\n  if (moment.isMoment(value)) {\n    return value;\n  }\n  if (isFinite(value)) {\n    return moment(value);\n  }\n  // same as default `moment(value)`, but avoid fallback to `new Date()`\n  return moment(toString(value), [moment.ISO_8601, moment.RFC_2822]);\n}\n\nexport function createDateTimeFormatter(format: any) {\n  if (isString(format) && format !== \"\") {\n    return (value: any) => {\n      if (value === null) {\n        return <NullValueComponent/>;\n      }\n      const wrapped = toMoment(value);\n      return wrapped.isValid() ? wrapped.format(format) : toString(value);\n    };\n  }\n  return (value: any) => value === null ? <NullValueComponent/> : toString(value);\n}\n\nexport function createBooleanFormatter(values: any) {\n  if (isArray(values)) {\n    if (values.length >= 2) {\n      // Both `true` and `false` specified\n      return (value: any) => {\n        if (value === null) {\n          return <NullValueComponent/>;\n        }\n        if (isNil(value)) {\n          return \"\";\n        }\n        return \"\" + values[value ? 1 : 0];\n      };\n    } else if (values.length === 1) {\n      // Only `true`\n      return (value: any) => (value ? values[0] : \"\");\n    }\n  }\n  return (value: any) => {\n    if (value === null) {\n      return <NullValueComponent/>;\n    }\n    if (isNil(value)) {\n      return \"\";\n    }\n    return value ? \"true\" : \"false\";\n  };\n}\n\nexport function createNumberFormatter(format: any, canReturnHTMLElement: boolean = false) {\n  if (isString(format) && format !== \"\") {\n    const n = numeral(0); // cache `numeral` instance\n    return (value: any) => {\n        if (canReturnHTMLElement && value === null) {\n            return <NullValueComponent/>;\n        }\n        if (value === \"\" || value === null) {\n            return \"\";\n        }\n        return n.set(value).format(format);\n    }\n  }\n  return (value: any) => (canReturnHTMLElement && value === null) ? <NullValueComponent/> : toString(value);\n}\n\nexport function formatSimpleTemplate(str: any, data: any) {\n  if (!isString(str)) {\n    return \"\";\n  }\n  return str.replace(/{{\\s*([^\\s]+?)\\s*}}/g, (match, prop) => {\n    if (hasOwnProperty.call(data, prop) && !isUndefined(data[prop])) {\n      return data[prop];\n    }\n    return match;\n  });\n}\n"],"mappings":"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"}