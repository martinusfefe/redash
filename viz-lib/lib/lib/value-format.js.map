{"version":3,"file":"value-format.js","names":["_react","_interopRequireDefault","require","_server","_moment","_numeral","_lodash","_visualizationsSettings","obj","__esModule","default","numeral","options","scalePercentBy100","urlPattern","hasOwnProperty","Object","prototype","NullValueComponent","createElement","className","visualizationsSettings","nullValue","createTextFormatter","highlightLinks","value","isString","Link","LinkComponent","replace","unused","prefix","href","link","ReactDOMServer","renderToStaticMarkup","target","rel","toString","toMoment","moment","isMoment","isFinite","ISO_8601","RFC_2822","createDateTimeFormatter","format","wrapped","isValid","createBooleanFormatter","values","isArray","length","isNil","createNumberFormatter","canReturnHTMLElement","arguments","undefined","n","set","formatSimpleTemplate","str","data","match","prop","call","isUndefined"],"sources":["../../src/lib/value-format.tsx"],"sourcesContent":["import React from \"react\";\nimport ReactDOMServer from \"react-dom/server\";\nimport moment from \"moment/moment\";\nimport numeral from \"numeral\";\nimport { isString, isArray, isUndefined, isFinite, isNil, toString } from \"lodash\";\nimport { visualizationsSettings } from \"@/visualizations/visualizationsSettings\";\n\n\nnumeral.options.scalePercentBy100 = false;\n\n// eslint-disable-next-line\nconst urlPattern = /(^|[\\s\\n]|<br\\/?>)((?:https?|ftp):\\/\\/[\\-A-Z0-9+\\u0026\\u2019@#\\/%?=()~_|!:,.;]*[\\-A-Z0-9+\\u0026@#\\/%=~()_|])/gi;\n\nconst hasOwnProperty = Object.prototype.hasOwnProperty;\n\nfunction NullValueComponent() {\n  return <span className=\"display-as-null\">{visualizationsSettings.nullValue}</span>;\n}\n\nexport function createTextFormatter(highlightLinks: any) {\n  if (highlightLinks) {\n    return (value: any) => {\n      if (value === null) {\n        return <NullValueComponent/>\n      }\n      if (isString(value)) {\n        const Link = visualizationsSettings.LinkComponent;\n        value = value.replace(urlPattern, (unused, prefix, href) => {\n          const link = ReactDOMServer.renderToStaticMarkup(\n            <Link href={href} target=\"_blank\" rel=\"noopener noreferrer\">\n              {href}\n            </Link>\n          );\n          return prefix + link;\n        });\n      }\n      return toString(value);\n    };\n  }\n  return (value: any) => value === null ? <NullValueComponent/> : toString(value);\n}\n\nfunction toMoment(value: any) {\n  if (moment.isMoment(value)) {\n    return value;\n  }\n  if (isFinite(value)) {\n    return moment(value);\n  }\n  // same as default `moment(value)`, but avoid fallback to `new Date()`\n  return moment(toString(value), [moment.ISO_8601, moment.RFC_2822]);\n}\n\nexport function createDateTimeFormatter(format: any) {\n  if (isString(format) && format !== \"\") {\n    return (value: any) => {\n      if (value === null) {\n        return <NullValueComponent/>;\n      }\n      const wrapped = toMoment(value);\n      return wrapped.isValid() ? wrapped.format(format) : toString(value);\n    };\n  }\n  return (value: any) => value === null ? <NullValueComponent/> : toString(value);\n}\n\nexport function createBooleanFormatter(values: any) {\n  if (isArray(values)) {\n    if (values.length >= 2) {\n      // Both `true` and `false` specified\n      return (value: any) => {\n        if (value === null) {\n          return <NullValueComponent/>;\n        }\n        if (isNil(value)) {\n          return \"\";\n        }\n        return \"\" + values[value ? 1 : 0];\n      };\n    } else if (values.length === 1) {\n      // Only `true`\n      return (value: any) => (value ? values[0] : \"\");\n    }\n  }\n  return (value: any) => {\n    if (value === null) {\n      return <NullValueComponent/>;\n    }\n    if (isNil(value)) {\n      return \"\";\n    }\n    return value ? \"true\" : \"false\";\n  };\n}\n\nexport function createNumberFormatter(format: any, canReturnHTMLElement: boolean = false) {\n  if (isString(format) && format !== \"\") {\n    const n = numeral(0); // cache `numeral` instance\n    return (value: any) => {\n        if (canReturnHTMLElement && value === null) {\n            return <NullValueComponent/>;\n        }\n        if (value === \"\" || value === null) {\n            return \"\";\n        }\n        return n.set(value).format(format);\n    }\n  }\n  return (value: any) => (canReturnHTMLElement && value === null) ? <NullValueComponent/> : toString(value);\n}\n\nexport function formatSimpleTemplate(str: any, data: any) {\n  if (!isString(str)) {\n    return \"\";\n  }\n  return str.replace(/{{\\s*([^\\s]+?)\\s*}}/g, (match, prop) => {\n    if (hasOwnProperty.call(data, prop) && !isUndefined(data[prop])) {\n      return data[prop];\n    }\n    return match;\n  });\n}\n"],"mappings":"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"}