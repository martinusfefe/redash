{"version":3,"file":"ErrorBoundary.js","names":["isFunction","React","debug","Alert","logger","ErrorBoundaryContext","createContext","handleError","error","setTimeout","reset","ErrorMessage","_ref","children","createElement","message","type","showIcon","defaultProps","ErrorBoundary","Component","constructor","arguments","_defineProperty","setState","getDerivedStateFromError","componentDidCatch","window","handleException","errorInfo","render","_this$props","props","renderError","state","Provider","value"],"sources":["../../src/components/ErrorBoundary.tsx"],"sourcesContent":["import { isFunction } from \"lodash\";\nimport React from \"react\";\nimport debug from \"debug\";\nimport Alert from \"antd/lib/alert\";\n\nconst logger = debug(\"redash:errors\");\n\nexport const ErrorBoundaryContext = React.createContext({\n  handleError: (error: any) => {\n    // Allow calling chain to roll up, and then throw the error in global context\n    setTimeout(() => {\n      throw error;\n    });\n  },\n  reset: () => {},\n});\n\ntype OwnErrorMessageProps = {\n  children?: React.ReactNode;\n};\n\ntype ErrorMessageProps = OwnErrorMessageProps & typeof ErrorMessage.defaultProps;\n\nexport function ErrorMessage({ children }: ErrorMessageProps) {\n  return <Alert message={children} type=\"error\" showIcon />;\n}\n\nErrorMessage.defaultProps = {\n  children: \"Something went wrong.\",\n};\n\ntype OwnErrorBoundaryProps = {\n  renderError?: (...args: any[]) => any;\n};\n\ntype ErrorBoundaryState = any;\n\ntype ErrorBoundaryProps = OwnErrorBoundaryProps & typeof ErrorBoundary.defaultProps;\n\nexport default class ErrorBoundary extends React.Component<ErrorBoundaryProps, ErrorBoundaryState> {\n  static defaultProps = {\n    children: null,\n    renderError: null,\n  };\n\n  state = { error: null };\n\n  handleError = (error: any) => {\n    // @ts-expect-error ts-migrate(2339) FIXME: Property 'getDerivedStateFromError' does not exist... Remove this comment to see the full error message\n    this.setState(this.constructor.getDerivedStateFromError(error));\n    this.componentDidCatch(error, null);\n    // @ts-expect-error ts-migrate(2339) FIXME: Property 'handleException' does not exist on type ... Remove this comment to see the full error message\n    if (isFunction(window.handleException)) {\n      // @ts-expect-error ts-migrate(2339) FIXME: Property 'handleException' does not exist on type ... Remove this comment to see the full error message\n      window.handleException(error);\n    }\n  };\n\n  reset = () => {\n    this.setState({ error: null });\n  };\n\n  static getDerivedStateFromError(error: any) {\n    return { error };\n  }\n\n  componentDidCatch(error: any, errorInfo: any) {\n    logger(error, errorInfo);\n  }\n\n  render() {\n    const { renderError, children } = this.props;\n    const { error } = this.state;\n\n    if (error) {\n      if (isFunction(renderError)) {\n        // @ts-expect-error ts-migrate(2349) FIXME: This expression is not callable.\n        return renderError(error);\n      }\n      return <ErrorMessage />;\n    }\n\n    return <ErrorBoundaryContext.Provider value={this}>{children}</ErrorBoundaryContext.Provider>;\n  }\n}\n"],"mappings":";;;AAAA,SAASA,UAAU,QAAQ,QAAQ;AACnC,OAAOC,KAAK,MAAM,OAAO;AACzB,OAAOC,KAAK,MAAM,OAAO;AACzB,OAAOC,KAAK,MAAM,gBAAgB;AAElC,IAAMC,MAAM,GAAGF,KAAK,CAAC,eAAe,CAAC;AAErC,OAAO,IAAMG,oBAAoB,GAAGJ,KAAK,CAACK,aAAa,CAAC;EACtDC,WAAW,EAAGC,KAAU,IAAK;IAC3B;IACAC,UAAU,CAAC,MAAM;MACf,MAAMD,KAAK;IACb,CAAC,CAAC;EACJ,CAAC;EACDE,KAAK,EAAEA,CAAA,KAAM,CAAC;AAChB,CAAC,CAAC;AAQF,OAAO,SAASC,YAAYA,CAAAC,IAAA,EAAkC;EAAA,IAA/BC,QAAQ,GAAAD,IAAA,CAARC,QAAQ;EACrC,oBAAOZ,KAAA,CAAAa,aAAA,CAACX,KAAK;IAACY,OAAO,EAAEF,QAAS;IAACG,IAAI,EAAC,OAAO;IAACC,QAAQ;EAAA,CAAE,CAAC;AAC3D;AAEAN,YAAY,CAACO,YAAY,GAAG;EAC1BL,QAAQ,EAAE;AACZ,CAAC;AAUD,eAAe,MAAMM,aAAa,SAASlB,KAAK,CAACmB,SAAS,CAAyC;EAAAC,YAAA;IAAA,SAAAC,SAAA;IAAAC,eAAA,gBAMzF;MAAEf,KAAK,EAAE;IAAK,CAAC;IAAAe,eAAA,sBAERf,KAAU,IAAK;MAC5B;MACA,IAAI,CAACgB,QAAQ,CAAC,IAAI,CAACH,WAAW,CAACI,wBAAwB,CAACjB,KAAK,CAAC,CAAC;MAC/D,IAAI,CAACkB,iBAAiB,CAAClB,KAAK,EAAE,IAAI,CAAC;MACnC;MACA,IAAIR,UAAU,CAAC2B,MAAM,CAACC,eAAe,CAAC,EAAE;QACtC;QACAD,MAAM,CAACC,eAAe,CAACpB,KAAK,CAAC;MAC/B;IACF,CAAC;IAAAe,eAAA,gBAEO,MAAM;MACZ,IAAI,CAACC,QAAQ,CAAC;QAAEhB,KAAK,EAAE;MAAK,CAAC,CAAC;IAChC,CAAC;EAAA;EAED,OAAOiB,wBAAwBA,CAACjB,KAAU,EAAE;IAC1C,OAAO;MAAEA;IAAM,CAAC;EAClB;EAEAkB,iBAAiBA,CAAClB,KAAU,EAAEqB,SAAc,EAAE;IAC5CzB,MAAM,CAACI,KAAK,EAAEqB,SAAS,CAAC;EAC1B;EAEAC,MAAMA,CAAA,EAAG;IACP,IAAAC,WAAA,GAAkC,IAAI,CAACC,KAAK;MAApCC,WAAW,GAAAF,WAAA,CAAXE,WAAW;MAAEpB,QAAQ,GAAAkB,WAAA,CAARlB,QAAQ;IAC7B,IAAQL,KAAK,GAAK,IAAI,CAAC0B,KAAK,CAApB1B,KAAK;IAEb,IAAIA,KAAK,EAAE;MACT,IAAIR,UAAU,CAACiC,WAAW,CAAC,EAAE;QAC3B;QACA,OAAOA,WAAW,CAACzB,KAAK,CAAC;MAC3B;MACA,oBAAOP,KAAA,CAAAa,aAAA,CAACH,YAAY,MAAE,CAAC;IACzB;IAEA,oBAAOV,KAAA,CAAAa,aAAA,CAACT,oBAAoB,CAAC8B,QAAQ;MAACC,KAAK,EAAE;IAAK,GAAEvB,QAAwC,CAAC;EAC/F;AACF;AAACU,eAAA,CA7CoBJ,aAAa,kBACV;EACpBN,QAAQ,EAAE,IAAI;EACdoB,WAAW,EAAE;AACf,CAAC"}