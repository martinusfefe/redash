{"version":3,"file":"prepareLayout.js","names":["_lodash","require","_preparePieData","getAxisTitle","axis","isObject","title","text","getAxisScaleType","type","prepareXAxis","axisOptions","additionalOptions","_axisOptions$tickForm","automargin","tickformat","tickFormat","sortX","reverseX","categoryorder","isUndefined","labels","showticklabels","enabled","prepareYAxis","_axisOptions$tickForm2","autorange","range","preparePieLayout","layout","options","data","hasName","test","textFormat","_getPieDimensions","getPieDimensions","cellsInRow","cellWidth","cellHeight","xPadding","annotations","filter","map","series","index","xPosition","yPosition","Math","floor","x","y","xanchor","yanchor","name","showarrow","prepareDefaultLayout","y2Series","s","yaxis","xaxis","xAxis","yAxis","length","yaxis2","overlaying","side","stacking","barmode","prepareBoxLayout","boxmode","boxgroupgap","prepareLayout","element","margin","l","r","b","t","pad","width","max","offsetWidth","height","offsetHeight","autosize","showlegend","legend","traceorder","hoverlabel","namelength","includes","globalSeriesType","hovermode","swappedAxes"],"sources":["../../../../src/visualizations/chart/plotly/prepareLayout.ts"],"sourcesContent":["import { isObject, isUndefined, filter, map } from \"lodash\";\nimport { getPieDimensions } from \"./preparePieData\";\n\nfunction getAxisTitle(axis: any) {\n  return isObject(axis.title) ? axis.title.text : null;\n}\n\nfunction getAxisScaleType(axis: any) {\n  switch (axis.type) {\n    case \"datetime\":\n      return \"date\";\n    case \"logarithmic\":\n      return \"log\";\n    default:\n      return axis.type;\n  }\n}\n\nfunction prepareXAxis(axisOptions: any, additionalOptions: any) {\n  const axis = {\n    title: getAxisTitle(axisOptions),\n    type: getAxisScaleType(axisOptions),\n    automargin: true,\n    tickformat: axisOptions.tickFormat ?? null,\n  };\n\n  if (additionalOptions.sortX && axis.type === \"category\") {\n    if (additionalOptions.reverseX) {\n      // @ts-expect-error ts-migrate(2339) FIXME: Property 'categoryorder' does not exist on type '{... Remove this comment to see the full error message\n      axis.categoryorder = \"category descending\";\n    } else {\n      // @ts-expect-error ts-migrate(2339) FIXME: Property 'categoryorder' does not exist on type '{... Remove this comment to see the full error message\n      axis.categoryorder = \"category ascending\";\n    }\n  }\n\n  if (!isUndefined(axisOptions.labels)) {\n    // @ts-expect-error ts-migrate(2339) FIXME: Property 'showticklabels' does not exist on type '... Remove this comment to see the full error message\n    axis.showticklabels = axisOptions.labels.enabled;\n  }\n\n  return axis;\n}\n\nfunction prepareYAxis(axisOptions: any) {\n  return {\n    title: getAxisTitle(axisOptions),\n    type: getAxisScaleType(axisOptions),\n    automargin: true,\n    autorange: true,\n    range: null,\n    tickformat: axisOptions.tickFormat ?? null,\n  };\n}\n\nfunction preparePieLayout(layout: any, options: any, data: any) {\n  const hasName = /{{\\s*@@name\\s*}}/.test(options.textFormat);\n\n  const { cellsInRow, cellWidth, cellHeight, xPadding } = getPieDimensions(data);\n\n  if (hasName) {\n    layout.annotations = [];\n  } else {\n    layout.annotations = filter(\n      map(data, (series, index) => {\n        // @ts-expect-error ts-migrate(2362) FIXME: The left-hand side of an arithmetic operation must... Remove this comment to see the full error message\n        const xPosition = (index % cellsInRow) * cellWidth;\n        // @ts-expect-error ts-migrate(2362) FIXME: The left-hand side of an arithmetic operation must... Remove this comment to see the full error message\n        const yPosition = Math.floor(index / cellsInRow) * cellHeight;\n        return {\n          x: xPosition + (cellWidth - xPadding) / 2,\n          y: yPosition + cellHeight - 0.015,\n          xanchor: \"center\",\n          yanchor: \"top\",\n          text: series.name,\n          showarrow: false,\n        };\n      })\n    );\n  }\n\n  return layout;\n}\n\nfunction prepareDefaultLayout(layout: any, options: any, data: any) {\n  const y2Series = data.filter((s: any) => s.yaxis === \"y2\");\n\n  layout.xaxis = prepareXAxis(options.xAxis, options);\n\n  layout.yaxis = prepareYAxis(options.yAxis[0]);\n  if (y2Series.length > 0) {\n    layout.yaxis2 = prepareYAxis(options.yAxis[1]);\n    layout.yaxis2.overlaying = \"y\";\n    layout.yaxis2.side = \"right\";\n  }\n\n  if (options.series.stacking) {\n    layout.barmode = \"relative\";\n  }\n\n  return layout;\n}\n\nfunction prepareBoxLayout(layout: any, options: any, data: any) {\n  layout = prepareDefaultLayout(layout, options, data);\n  layout.boxmode = \"group\";\n  layout.boxgroupgap = 0.5;\n  return layout;\n}\n\nexport default function prepareLayout(element: any, options: any, data: any) {\n  const layout: any = {\n    margin: { l: 10, r: 10, b: 5, t: 20, pad: 4 },\n    // plot size should be at least 5x5px\n    width: Math.max(5, Math.floor(element.offsetWidth)),\n    height: Math.max(5, Math.floor(element.offsetHeight)),\n    autosize: false,\n    showlegend: options.legend.enabled,\n    legend: {\n      traceorder: options.legend.traceorder,\n    },\n    hoverlabel: {\n      namelength: -1,\n    },\n  };\n\n  if ([\"line\", \"area\", \"column\"].includes(options.globalSeriesType)) {\n    layout.hovermode = options.swappedAxes ? 'y' : 'x';\n  }\n\n  switch (options.globalSeriesType) {\n    case \"pie\":\n      return preparePieLayout(layout, options, data);\n    case \"box\":\n      return prepareBoxLayout(layout, options, data);\n    default:\n      return prepareDefaultLayout(layout, options, data);\n  }\n}\n"],"mappings":"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"}