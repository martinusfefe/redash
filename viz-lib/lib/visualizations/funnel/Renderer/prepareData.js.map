{"version":3,"file":"prepareData.js","names":["map","maxBy","sortBy","toString","moment","visualizationsSettings","stepValueToString","value","isMoment","format","dateTimeFormat","prepareData","rows","options","length","stepCol","colName","valueCol","sortKeyCol","reverse","data","row","step","parseFloat","maxVal","d","forEach","i","pctMax","pctPrevious","slice","itemsLimit"],"sources":["../../../../src/visualizations/funnel/Renderer/prepareData.ts"],"sourcesContent":["import { map, maxBy, sortBy, toString } from \"lodash\";\nimport moment from \"moment\";\nimport { visualizationsSettings } from \"@/visualizations/visualizationsSettings\";\n\nfunction stepValueToString(value: any) {\n  if (moment.isMoment(value)) {\n    const format = visualizationsSettings.dateTimeFormat || \"DD/MM/YYYY HH:mm\";\n    return value.format(format);\n  }\n  return toString(value);\n}\n\nexport default function prepareData(rows: any, options: any) {\n  if (rows.length === 0 || !options.stepCol.colName || !options.valueCol.colName) {\n    return [];\n  }\n\n  rows = [...rows];\n  if (options.sortKeyCol.colName) {\n    rows = sortBy(rows, options.sortKeyCol.colName);\n  }\n  if (options.sortKeyCol.reverse) {\n    rows = rows.reverse();\n  }\n\n  const data = map(rows, row => ({\n    step: stepValueToString(row[options.stepCol.colName]),\n    value: parseFloat(row[options.valueCol.colName]) || 0.0,\n  }));\n\n  // @ts-expect-error ts-migrate(2532) FIXME: Object is possibly 'undefined'.\n  const maxVal = maxBy(data, d => d.value).value;\n  data.forEach((d, i) => {\n    // @ts-expect-error ts-migrate(2339) FIXME: Property 'pctMax' does not exist on type '{ step: ... Remove this comment to see the full error message\n    d.pctMax = (d.value / maxVal) * 100.0;\n    // @ts-expect-error ts-migrate(2339) FIXME: Property 'pctPrevious' does not exist on type '{ s... Remove this comment to see the full error message\n    d.pctPrevious = i === 0 || d.value === data[i - 1].value ? 100.0 : (d.value / data[i - 1].value) * 100.0;\n  });\n\n  return data.slice(0, options.itemsLimit);\n}\n"],"mappings":"AAAA,SAASA,GAAG,EAAEC,KAAK,EAAEC,MAAM,EAAEC,QAAQ,QAAQ,QAAQ;AACrD,OAAOC,MAAM,MAAM,QAAQ;AAC3B,SAASC,sBAAsB;AAE/B,SAASC,iBAAiBA,CAACC,KAAU,EAAE;EACrC,IAAIH,MAAM,CAACI,QAAQ,CAACD,KAAK,CAAC,EAAE;IAC1B,IAAME,MAAM,GAAGJ,sBAAsB,CAACK,cAAc,IAAI,kBAAkB;IAC1E,OAAOH,KAAK,CAACE,MAAM,CAACA,MAAM,CAAC;EAC7B;EACA,OAAON,QAAQ,CAACI,KAAK,CAAC;AACxB;AAEA,eAAe,SAASI,WAAWA,CAACC,IAAS,EAAEC,OAAY,EAAE;EAC3D,IAAID,IAAI,CAACE,MAAM,KAAK,CAAC,IAAI,CAACD,OAAO,CAACE,OAAO,CAACC,OAAO,IAAI,CAACH,OAAO,CAACI,QAAQ,CAACD,OAAO,EAAE;IAC9E,OAAO,EAAE;EACX;EAEAJ,IAAI,GAAG,CAAC,GAAGA,IAAI,CAAC;EAChB,IAAIC,OAAO,CAACK,UAAU,CAACF,OAAO,EAAE;IAC9BJ,IAAI,GAAGV,MAAM,CAACU,IAAI,EAAEC,OAAO,CAACK,UAAU,CAACF,OAAO,CAAC;EACjD;EACA,IAAIH,OAAO,CAACK,UAAU,CAACC,OAAO,EAAE;IAC9BP,IAAI,GAAGA,IAAI,CAACO,OAAO,CAAC,CAAC;EACvB;EAEA,IAAMC,IAAI,GAAGpB,GAAG,CAACY,IAAI,EAAES,GAAG,KAAK;IAC7BC,IAAI,EAAEhB,iBAAiB,CAACe,GAAG,CAACR,OAAO,CAACE,OAAO,CAACC,OAAO,CAAC,CAAC;IACrDT,KAAK,EAAEgB,UAAU,CAACF,GAAG,CAACR,OAAO,CAACI,QAAQ,CAACD,OAAO,CAAC,CAAC,IAAI;EACtD,CAAC,CAAC,CAAC;;EAEH;EACA,IAAMQ,MAAM,GAAGvB,KAAK,CAACmB,IAAI,EAAEK,CAAC,IAAIA,CAAC,CAAClB,KAAK,CAAC,CAACA,KAAK;EAC9Ca,IAAI,CAACM,OAAO,CAAC,CAACD,CAAC,EAAEE,CAAC,KAAK;IACrB;IACAF,CAAC,CAACG,MAAM,GAAIH,CAAC,CAAClB,KAAK,GAAGiB,MAAM,GAAI,KAAK;IACrC;IACAC,CAAC,CAACI,WAAW,GAAGF,CAAC,KAAK,CAAC,IAAIF,CAAC,CAAClB,KAAK,KAAKa,IAAI,CAACO,CAAC,GAAG,CAAC,CAAC,CAACpB,KAAK,GAAG,KAAK,GAAIkB,CAAC,CAAClB,KAAK,GAAGa,IAAI,CAACO,CAAC,GAAG,CAAC,CAAC,CAACpB,KAAK,GAAI,KAAK;EAC1G,CAAC,CAAC;EAEF,OAAOa,IAAI,CAACU,KAAK,CAAC,CAAC,EAAEjB,OAAO,CAACkB,UAAU,CAAC;AAC1C"}