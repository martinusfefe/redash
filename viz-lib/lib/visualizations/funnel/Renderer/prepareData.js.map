{"version":3,"file":"prepareData.js","names":["_lodash","require","_moment","_interopRequireDefault","_visualizationsSettings","obj","__esModule","default","stepValueToString","value","moment","isMoment","format","visualizationsSettings","dateTimeFormat","toString","prepareData","rows","options","length","stepCol","colName","valueCol","sortKeyCol","sortBy","reverse","data","map","row","step","parseFloat","maxVal","maxBy","d","forEach","i","pctMax","pctPrevious","slice","itemsLimit"],"sources":["../../../../src/visualizations/funnel/Renderer/prepareData.ts"],"sourcesContent":["import { map, maxBy, sortBy, toString } from \"lodash\";\nimport moment from \"moment\";\nimport { visualizationsSettings } from \"@/visualizations/visualizationsSettings\";\n\nfunction stepValueToString(value: any) {\n  if (moment.isMoment(value)) {\n    const format = visualizationsSettings.dateTimeFormat || \"DD/MM/YYYY HH:mm\";\n    return value.format(format);\n  }\n  return toString(value);\n}\n\nexport default function prepareData(rows: any, options: any) {\n  if (rows.length === 0 || !options.stepCol.colName || !options.valueCol.colName) {\n    return [];\n  }\n\n  rows = [...rows];\n  if (options.sortKeyCol.colName) {\n    rows = sortBy(rows, options.sortKeyCol.colName);\n  }\n  if (options.sortKeyCol.reverse) {\n    rows = rows.reverse();\n  }\n\n  const data = map(rows, row => ({\n    step: stepValueToString(row[options.stepCol.colName]),\n    value: parseFloat(row[options.valueCol.colName]) || 0.0,\n  }));\n\n  // @ts-expect-error ts-migrate(2532) FIXME: Object is possibly 'undefined'.\n  const maxVal = maxBy(data, d => d.value).value;\n  data.forEach((d, i) => {\n    // @ts-expect-error ts-migrate(2339) FIXME: Property 'pctMax' does not exist on type '{ step: ... Remove this comment to see the full error message\n    d.pctMax = (d.value / maxVal) * 100.0;\n    // @ts-expect-error ts-migrate(2339) FIXME: Property 'pctPrevious' does not exist on type '{ s... Remove this comment to see the full error message\n    d.pctPrevious = i === 0 || d.value === data[i - 1].value ? 100.0 : (d.value / data[i - 1].value) * 100.0;\n  });\n\n  return data.slice(0, options.itemsLimit);\n}\n"],"mappings":";;;;;;AAAA,IAAAA,OAAA,GAAAC,OAAA;AACA,IAAAC,OAAA,GAAAC,sBAAA,CAAAF,OAAA;AACA,IAAAG,uBAAA,GAAAH,OAAA;AAAiF,SAAAE,uBAAAE,GAAA,WAAAA,GAAA,IAAAA,GAAA,CAAAC,UAAA,GAAAD,GAAA,KAAAE,OAAA,EAAAF,GAAA;AAEjF,SAASG,iBAAiBA,CAACC,KAAU,EAAE;EACrC,IAAIC,eAAM,CAACC,QAAQ,CAACF,KAAK,CAAC,EAAE;IAC1B,IAAMG,MAAM,GAAGC,8CAAsB,CAACC,cAAc,IAAI,kBAAkB;IAC1E,OAAOL,KAAK,CAACG,MAAM,CAACA,MAAM,CAAC;EAC7B;EACA,OAAO,IAAAG,gBAAQ,EAACN,KAAK,CAAC;AACxB;AAEe,SAASO,WAAWA,CAACC,IAAS,EAAEC,OAAY,EAAE;EAC3D,IAAID,IAAI,CAACE,MAAM,KAAK,CAAC,IAAI,CAACD,OAAO,CAACE,OAAO,CAACC,OAAO,IAAI,CAACH,OAAO,CAACI,QAAQ,CAACD,OAAO,EAAE;IAC9E,OAAO,EAAE;EACX;EAEAJ,IAAI,GAAG,CAAC,GAAGA,IAAI,CAAC;EAChB,IAAIC,OAAO,CAACK,UAAU,CAACF,OAAO,EAAE;IAC9BJ,IAAI,GAAG,IAAAO,cAAM,EAACP,IAAI,EAAEC,OAAO,CAACK,UAAU,CAACF,OAAO,CAAC;EACjD;EACA,IAAIH,OAAO,CAACK,UAAU,CAACE,OAAO,EAAE;IAC9BR,IAAI,GAAGA,IAAI,CAACQ,OAAO,CAAC,CAAC;EACvB;EAEA,IAAMC,IAAI,GAAG,IAAAC,WAAG,EAACV,IAAI,EAAEW,GAAG,KAAK;IAC7BC,IAAI,EAAErB,iBAAiB,CAACoB,GAAG,CAACV,OAAO,CAACE,OAAO,CAACC,OAAO,CAAC,CAAC;IACrDZ,KAAK,EAAEqB,UAAU,CAACF,GAAG,CAACV,OAAO,CAACI,QAAQ,CAACD,OAAO,CAAC,CAAC,IAAI;EACtD,CAAC,CAAC,CAAC;;EAEH;EACA,IAAMU,MAAM,GAAG,IAAAC,aAAK,EAACN,IAAI,EAAEO,CAAC,IAAIA,CAAC,CAACxB,KAAK,CAAC,CAACA,KAAK;EAC9CiB,IAAI,CAACQ,OAAO,CAAC,CAACD,CAAC,EAAEE,CAAC,KAAK;IACrB;IACAF,CAAC,CAACG,MAAM,GAAIH,CAAC,CAACxB,KAAK,GAAGsB,MAAM,GAAI,KAAK;IACrC;IACAE,CAAC,CAACI,WAAW,GAAGF,CAAC,KAAK,CAAC,IAAIF,CAAC,CAACxB,KAAK,KAAKiB,IAAI,CAACS,CAAC,GAAG,CAAC,CAAC,CAAC1B,KAAK,GAAG,KAAK,GAAIwB,CAAC,CAACxB,KAAK,GAAGiB,IAAI,CAACS,CAAC,GAAG,CAAC,CAAC,CAAC1B,KAAK,GAAI,KAAK;EAC1G,CAAC,CAAC;EAEF,OAAOiB,IAAI,CAACY,KAAK,CAAC,CAAC,EAAEpB,OAAO,CAACqB,UAAU,CAAC;AAC1C"}