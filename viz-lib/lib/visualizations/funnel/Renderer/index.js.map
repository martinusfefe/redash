{"version":3,"file":"index.js","names":["maxBy","React","useMemo","Table","Tooltip","RendererPropTypes","ColorPalette","createNumberFormatter","prepareData","FunnelBar","generateRowKeyPrefix","Math","trunc","random","Number","MAX_SAFE_INTEGER","toString","Renderer","_ref","data","options","funnelData","rows","rowKeyPrefix","formatValue","numberFormat","formatPercentValue","format","percentFormat","value","percentValuesRange","min","concat","max","columns","length","maxToPrevious","d","isFinite","pctPrevious","title","stepCol","displayAs","dataIndex","width","className","render","text","createElement","mouseEnterDelay","mouseLeaveDelay","valueCol","align","item","color","Cyan","pctMax","dataSource","rowKey","record","index","pagination","propTypes"],"sources":["../../../../src/visualizations/funnel/Renderer/index.tsx"],"sourcesContent":["import { maxBy } from \"lodash\";\nimport React, { useMemo } from \"react\";\nimport Table from \"antd/lib/table\";\nimport Tooltip from \"antd/lib/tooltip\";\nimport { RendererPropTypes } from \"@/visualizations/prop-types\";\nimport ColorPalette from \"@/visualizations/ColorPalette\";\nimport { createNumberFormatter } from \"@/lib/value-format\";\n\nimport prepareData from \"./prepareData\";\nimport FunnelBar from \"./FunnelBar\";\nimport \"./index.less\";\n\nfunction generateRowKeyPrefix() {\n  return Math.trunc(Math.random() * Number.MAX_SAFE_INTEGER).toString(36) + \":\";\n}\n\nexport default function Renderer({ data, options }: any) {\n  const funnelData = useMemo(() => prepareData(data.rows, options), [data, options]);\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  const rowKeyPrefix = useMemo(() => generateRowKeyPrefix(), [funnelData]);\n\n  const formatValue = useMemo(() => createNumberFormatter(options.numberFormat), [options.numberFormat]);\n\n  const formatPercentValue = useMemo(() => {\n    const format = createNumberFormatter(options.percentFormat);\n    return (value: any) => {\n      if (value < options.percentValuesRange.min) {\n        return `<${format(options.percentValuesRange.min)}`;\n      }\n      if (value > options.percentValuesRange.max) {\n        return `>${format(options.percentValuesRange.max)}`;\n      }\n      return format(value);\n    };\n  }, [options.percentFormat, options.percentValuesRange]);\n\n  const columns = useMemo(() => {\n    if (funnelData.length === 0) {\n      return [];\n    }\n\n    // @ts-expect-error ts-migrate(2532) FIXME: Object is possibly 'undefined'.\n    const maxToPrevious = maxBy(funnelData, d => (isFinite(d.pctPrevious) ? d.pctPrevious : 0)).pctPrevious;\n    return [\n      {\n        title: options.stepCol.displayAs,\n        dataIndex: \"step\",\n        width: \"25%\",\n        className: \"text-ellipsis\",\n        render: (text: any) => (\n          <Tooltip title={text} mouseEnterDelay={0} mouseLeaveDelay={0}>\n            {text}\n          </Tooltip>\n        ),\n      },\n      {\n        title: options.valueCol.displayAs,\n        dataIndex: \"value\",\n        width: \"45%\",\n        align: \"center\",\n        render: (value: any, item: any) => (\n          // @ts-expect-error ts-migrate(2745) FIXME: This JSX tag's 'children' prop expects type 'never... Remove this comment to see the full error message\n          <FunnelBar align=\"center\" color={ColorPalette.Cyan} value={item.pctMax}>\n            {formatValue(value)}\n          </FunnelBar>\n        ),\n      },\n      {\n        title: \"% Max\",\n        dataIndex: \"pctMax\",\n        width: \"15%\",\n        align: \"center\",\n        render: (value: any) => formatPercentValue(value),\n      },\n      {\n        title: \"% Previous\",\n        dataIndex: \"pctPrevious\",\n        width: \"15%\",\n        align: \"center\",\n        render: (value: any) => (\n          // @ts-expect-error ts-migrate(2745) FIXME: This JSX tag's 'children' prop expects type 'never... Remove this comment to see the full error message\n          <FunnelBar className=\"funnel-percent-column\" value={(value / maxToPrevious) * 100.0}>\n            {formatPercentValue(value)}\n          </FunnelBar>\n        ),\n      },\n    ];\n  }, [options.stepCol.displayAs, options.valueCol.displayAs, funnelData, formatValue, formatPercentValue]);\n\n  if (funnelData.length === 0) {\n    return null;\n  }\n\n  return (\n    <div className=\"funnel-visualization-container\">\n      <Table\n        // @ts-expect-error ts-migrate(2322) FIXME: Type '({ title: any; dataIndex: string; width: str... Remove this comment to see the full error message\n        columns={columns}\n        dataSource={funnelData}\n        rowKey={(record, index) => rowKeyPrefix + index}\n        pagination={false}\n      />\n    </div>\n  );\n}\n\nRenderer.propTypes = RendererPropTypes;\n"],"mappings":"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"}