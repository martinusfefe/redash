{"version":3,"file":"index.js","names":["_lodash","require","_react","_interopRequireWildcard","_table","_interopRequireDefault","_tooltip","_propTypes","_ColorPalette","_valueFormat","_prepareData","_FunnelBar","obj","__esModule","default","_getRequireWildcardCache","nodeInterop","WeakMap","cacheBabelInterop","cacheNodeInterop","cache","has","get","newObj","hasPropertyDescriptor","Object","defineProperty","getOwnPropertyDescriptor","key","prototype","hasOwnProperty","call","desc","set","generateRowKeyPrefix","Math","trunc","random","Number","MAX_SAFE_INTEGER","toString","Renderer","_ref","data","options","funnelData","useMemo","prepareData","rows","rowKeyPrefix","formatValue","createNumberFormatter","numberFormat","formatPercentValue","format","percentFormat","value","percentValuesRange","min","concat","max","columns","length","maxToPrevious","maxBy","d","isFinite","pctPrevious","title","stepCol","displayAs","dataIndex","width","className","render","text","createElement","mouseEnterDelay","mouseLeaveDelay","valueCol","align","item","color","ColorPalette","Cyan","pctMax","dataSource","rowKey","record","index","pagination","propTypes","RendererPropTypes"],"sources":["../../../../src/visualizations/funnel/Renderer/index.tsx"],"sourcesContent":["import { maxBy } from \"lodash\";\nimport React, { useMemo } from \"react\";\nimport Table from \"antd/lib/table\";\nimport Tooltip from \"antd/lib/tooltip\";\nimport { RendererPropTypes } from \"@/visualizations/prop-types\";\nimport ColorPalette from \"@/visualizations/ColorPalette\";\nimport { createNumberFormatter } from \"@/lib/value-format\";\n\nimport prepareData from \"./prepareData\";\nimport FunnelBar from \"./FunnelBar\";\nimport \"./index.less\";\n\nfunction generateRowKeyPrefix() {\n  return Math.trunc(Math.random() * Number.MAX_SAFE_INTEGER).toString(36) + \":\";\n}\n\nexport default function Renderer({ data, options }: any) {\n  const funnelData = useMemo(() => prepareData(data.rows, options), [data, options]);\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  const rowKeyPrefix = useMemo(() => generateRowKeyPrefix(), [funnelData]);\n\n  const formatValue = useMemo(() => createNumberFormatter(options.numberFormat), [options.numberFormat]);\n\n  const formatPercentValue = useMemo(() => {\n    const format = createNumberFormatter(options.percentFormat);\n    return (value: any) => {\n      if (value < options.percentValuesRange.min) {\n        return `<${format(options.percentValuesRange.min)}`;\n      }\n      if (value > options.percentValuesRange.max) {\n        return `>${format(options.percentValuesRange.max)}`;\n      }\n      return format(value);\n    };\n  }, [options.percentFormat, options.percentValuesRange]);\n\n  const columns = useMemo(() => {\n    if (funnelData.length === 0) {\n      return [];\n    }\n\n    // @ts-expect-error ts-migrate(2532) FIXME: Object is possibly 'undefined'.\n    const maxToPrevious = maxBy(funnelData, d => (isFinite(d.pctPrevious) ? d.pctPrevious : 0)).pctPrevious;\n    return [\n      {\n        title: options.stepCol.displayAs,\n        dataIndex: \"step\",\n        width: \"25%\",\n        className: \"text-ellipsis\",\n        render: (text: any) => (\n          <Tooltip title={text} mouseEnterDelay={0} mouseLeaveDelay={0}>\n            {text}\n          </Tooltip>\n        ),\n      },\n      {\n        title: options.valueCol.displayAs,\n        dataIndex: \"value\",\n        width: \"45%\",\n        align: \"center\",\n        render: (value: any, item: any) => (\n          // @ts-expect-error ts-migrate(2745) FIXME: This JSX tag's 'children' prop expects type 'never... Remove this comment to see the full error message\n          <FunnelBar align=\"center\" color={ColorPalette.Cyan} value={item.pctMax}>\n            {formatValue(value)}\n          </FunnelBar>\n        ),\n      },\n      {\n        title: \"% Max\",\n        dataIndex: \"pctMax\",\n        width: \"15%\",\n        align: \"center\",\n        render: (value: any) => formatPercentValue(value),\n      },\n      {\n        title: \"% Previous\",\n        dataIndex: \"pctPrevious\",\n        width: \"15%\",\n        align: \"center\",\n        render: (value: any) => (\n          // @ts-expect-error ts-migrate(2745) FIXME: This JSX tag's 'children' prop expects type 'never... Remove this comment to see the full error message\n          <FunnelBar className=\"funnel-percent-column\" value={(value / maxToPrevious) * 100.0}>\n            {formatPercentValue(value)}\n          </FunnelBar>\n        ),\n      },\n    ];\n  }, [options.stepCol.displayAs, options.valueCol.displayAs, funnelData, formatValue, formatPercentValue]);\n\n  if (funnelData.length === 0) {\n    return null;\n  }\n\n  return (\n    <div className=\"funnel-visualization-container\">\n      <Table\n        // @ts-expect-error ts-migrate(2322) FIXME: Type '({ title: any; dataIndex: string; width: str... Remove this comment to see the full error message\n        columns={columns}\n        dataSource={funnelData}\n        rowKey={(record, index) => rowKeyPrefix + index}\n        pagination={false}\n      />\n    </div>\n  );\n}\n\nRenderer.propTypes = RendererPropTypes;\n"],"mappings":"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"}