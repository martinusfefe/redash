{"version":3,"file":"Renderer.js","names":["map","each","d3","React","useState","useEffect","resizeObserver","RendererPropTypes","box","calcIqr","k","d","q1","quartiles","q3","iqr","i","j","length","render","container","data","_ref","xAxisLabel","yAxisLabel","select","containerBounds","node","getBoundingClientRect","containerWidth","Math","floor","width","containerHeight","height","margin","top","right","bottom","left","inner","min","Infinity","max","mydata","value","columns","col","name","xscale","scale","ordinal","domain","rangeBands","boxWidth","column","rows","row","push","ceil","yscale","linear","range","chart","whiskers","xAxis","svg","axis","orient","yAxis","xLines","tickSize","yLines","barOffset","selectAll","remove","append","attr","plot","concat","text","call","enter","_","Renderer","_ref2","options","_useState","_useState2","_slicedToArray","setContainer","unwatch","createElement","className","ref","propTypes"],"sources":["../../../src/visualizations/box-plot/Renderer.tsx"],"sourcesContent":["import { map, each } from \"lodash\";\nimport * as d3 from \"d3\";\nimport React, { useState, useEffect } from \"react\";\nimport resizeObserver from \"@/services/resizeObserver\";\nimport { RendererPropTypes } from \"@/visualizations/prop-types\";\nimport box from \"./d3box\";\nimport \"./renderer.less\";\n\nfunction calcIqr(k: any) {\n  return (d: any) => {\n    const q1 = d.quartiles[0];\n    const q3 = d.quartiles[2];\n    const iqr = (q3 - q1) * k;\n\n    let i = -1;\n    let j = d.length;\n\n    i += 1;\n    while (d[i] < q1 - iqr) {\n      i += 1;\n    }\n\n    j -= 1;\n    while (d[j] > q3 + iqr) {\n      j -= 1;\n    }\n\n    return [i, j];\n  };\n}\n\nfunction render(container: any, data: any, { xAxisLabel, yAxisLabel }: any) {\n  container = d3.select(container);\n\n  const containerBounds = container.node().getBoundingClientRect();\n  const containerWidth = Math.floor(containerBounds.width);\n  const containerHeight = Math.floor(containerBounds.height);\n\n  const margin = {\n    top: 10,\n    right: 50,\n    bottom: 40,\n    left: 50,\n    inner: 25,\n  };\n  const width = containerWidth - margin.right - margin.left;\n  const height = containerHeight - margin.top - margin.bottom;\n\n  let min = Infinity;\n  let max = -Infinity;\n  const mydata: any = [];\n  let value = 0;\n  let d = [];\n\n  const columns = map(data.columns, col => col.name);\n  // @ts-expect-error ts-migrate(2339) FIXME: Property 'scale' does not exist on type 'typeof im... Remove this comment to see the full error message\n  const xscale = d3.scale\n    .ordinal()\n    .domain(columns)\n    .rangeBands([0, containerWidth - margin.left - margin.right]);\n\n  let boxWidth;\n  if (columns.length > 1) {\n    boxWidth = Math.min(xscale(columns[1]), 120.0);\n  } else {\n    boxWidth = 120.0;\n  }\n  margin.inner = boxWidth / 3.0;\n\n  each(columns, (column, i) => {\n    d = mydata[i] = [];\n    each(data.rows, row => {\n      value = row[column];\n      d.push(value);\n      if (value > max) max = Math.ceil(value);\n      if (value < min) min = Math.floor(value);\n    });\n  });\n\n  // @ts-expect-error ts-migrate(2339) FIXME: Property 'scale' does not exist on type 'typeof im... Remove this comment to see the full error message\n  const yscale = d3.scale\n    .linear()\n    .domain([min * 0.99, max * 1.01])\n    .range([height, 0]);\n\n  const chart = box()\n    .whiskers(calcIqr(1.5))\n    // @ts-expect-error ts-migrate(2339) FIXME: Property 'width' does not exist on type '{ (g: any... Remove this comment to see the full error message\n    .width(boxWidth - 2 * margin.inner)\n    .height(height)\n    .domain([min * 0.99, max * 1.01]);\n  const xAxis = d3.svg\n    // @ts-expect-error ts-migrate(2339) FIXME: Property 'axis' does not exist on type '(url: stri... Remove this comment to see the full error message\n    .axis()\n    .scale(xscale)\n    .orient(\"bottom\");\n\n  const yAxis = d3.svg\n    // @ts-expect-error ts-migrate(2339) FIXME: Property 'axis' does not exist on type '(url: stri... Remove this comment to see the full error message\n    .axis()\n    .scale(yscale)\n    .orient(\"left\");\n\n  const xLines = d3.svg\n    // @ts-expect-error ts-migrate(2339) FIXME: Property 'axis' does not exist on type '(url: stri... Remove this comment to see the full error message\n    .axis()\n    .scale(xscale)\n    .tickSize(height)\n    .orient(\"bottom\");\n\n  const yLines = d3.svg\n    // @ts-expect-error ts-migrate(2339) FIXME: Property 'axis' does not exist on type '(url: stri... Remove this comment to see the full error message\n    .axis()\n    .scale(yscale)\n    .tickSize(width)\n    .orient(\"right\");\n\n  function barOffset(i: any) {\n    return xscale(columns[i]) + (xscale(columns[1]) - margin.inner) / 2.0;\n  }\n\n  container.selectAll(\"*\").remove();\n\n  const svg = container\n    .append(\"svg\")\n    .attr(\"width\", containerWidth)\n    .attr(\"height\", height + margin.bottom + margin.top);\n\n  const plot = svg\n    .append(\"g\")\n    .attr(\"width\", containerWidth - margin.left - margin.right)\n    .attr(\"transform\", `translate(${margin.left},${margin.top})`);\n\n  svg\n    .append(\"text\")\n    .attr(\"class\", \"box\")\n    .attr(\"x\", containerWidth / 2.0)\n    .attr(\"text-anchor\", \"middle\")\n    .attr(\"y\", height + margin.bottom)\n    .text(xAxisLabel);\n\n  svg\n    .append(\"text\")\n    .attr(\"class\", \"box\")\n    .attr(\"transform\", `translate(10,${(height + margin.top + margin.bottom) / 2.0})rotate(-90)`)\n    .attr(\"text-anchor\", \"middle\")\n    .text(yAxisLabel);\n\n  plot\n    .append(\"rect\")\n    .attr(\"class\", \"grid-background\")\n    .attr(\"width\", width)\n    .attr(\"height\", height);\n\n  plot\n    .append(\"g\")\n    .attr(\"class\", \"grid\")\n    .call(yLines);\n\n  plot\n    .append(\"g\")\n    .attr(\"class\", \"grid\")\n    .call(xLines);\n\n  plot\n    .append(\"g\")\n    .attr(\"class\", \"x axis\")\n    .attr(\"transform\", `translate(0,${height})`)\n    .call(xAxis);\n\n  plot\n    .append(\"g\")\n    .attr(\"class\", \"y axis\")\n    .call(yAxis);\n\n  plot\n    .selectAll(\".box\")\n    .data(mydata)\n    .enter()\n    .append(\"g\")\n    .attr(\"class\", \"box\")\n    .attr(\"width\", boxWidth)\n    .attr(\"height\", height)\n    .attr(\"transform\", (_: any, i: any) => `translate(${barOffset(i)},${0})`)\n    .call(chart);\n}\n\nexport default function Renderer({ data, options }: any) {\n  const [container, setContainer] = useState(null);\n\n  useEffect(() => {\n    if (container) {\n      render(container, data, options);\n      const unwatch = resizeObserver(container, () => {\n        render(container, data, options);\n      });\n      return unwatch;\n    }\n  }, [container, data, options]);\n\n  // @ts-expect-error ts-migrate(2322) FIXME: Type 'Dispatch<SetStateAction<null>>' is not assig... Remove this comment to see the full error message\n  return <div className=\"box-plot-deprecated-visualization-container\" ref={setContainer} />;\n}\n\nRenderer.propTypes = RendererPropTypes;\n"],"mappings":"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"}