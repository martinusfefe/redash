{"version":3,"file":"index.js","names":["omit","noop","React","useState","useEffect","useRef","RendererPropTypes","useMemoWithDeepCompare","useLoadGeoJson","initChoropleth","prepareData","Renderer","_ref","data","options","onOptionsChange","_useState","_useState2","_slicedToArray","container","setContainer","_useLoadGeoJson","mapType","_useLoadGeoJson2","geoJson","onBoundsChangeRef","current","bounds","_objectSpread","optionsWithoutBounds","_useState3","_useState4","map","setMap","_map","arguments","destroy","updateLayers","rows","keyColumn","valueColumn","updateBounds","createElement","className","style","background","colors","ref","propTypes"],"sources":["../../../../src/visualizations/choropleth/Renderer/index.tsx"],"sourcesContent":["import { omit, noop } from \"lodash\";\nimport React, { useState, useEffect, useRef } from \"react\";\nimport { RendererPropTypes } from \"@/visualizations/prop-types\";\nimport useMemoWithDeepCompare from \"@/lib/hooks/useMemoWithDeepCompare\";\n\nimport useLoadGeoJson from \"../hooks/useLoadGeoJson\";\nimport initChoropleth from \"./initChoropleth\";\nimport { prepareData } from \"./utils\";\nimport \"./renderer.less\";\n\nexport default function Renderer({ data, options, onOptionsChange }: any) {\n  const [container, setContainer] = useState(null);\n  const [geoJson] = useLoadGeoJson(options.mapType);\n  const onBoundsChangeRef = useRef();\n  // @ts-expect-error ts-migrate(2322) FIXME: Type '(...args: any[]) => void' is not assignable ... Remove this comment to see the full error message\n  onBoundsChangeRef.current = onOptionsChange ? (bounds: any) => onOptionsChange({ ...options, bounds }) : noop;\n\n  const optionsWithoutBounds = useMemoWithDeepCompare(() => omit(options, [\"bounds\"]), [options]);\n\n  const [map, setMap] = useState(null);\n\n  useEffect(() => {\n    if (container) {\n      // @ts-expect-error ts-migrate(7019) FIXME: Rest parameter 'args' implicitly has an 'any[]' ty... Remove this comment to see the full error message\n      const _map = initChoropleth(container, (...args) => onBoundsChangeRef.current(...args));\n      // @ts-expect-error ts-migrate(2345) FIXME: Argument of type '{ updateLayers: (geoJson: any, d... Remove this comment to see the full error message\n      setMap(_map);\n      return () => {\n        _map.destroy();\n      };\n    }\n  }, [container]);\n\n  useEffect(() => {\n    if (map) {\n      // @ts-expect-error ts-migrate(2531) FIXME: Object is possibly 'null'.\n      map.updateLayers(\n        geoJson,\n        // @ts-expect-error ts-migrate(2532) FIXME: Object is possibly 'undefined'.\n        prepareData(data.rows, optionsWithoutBounds.keyColumn, optionsWithoutBounds.valueColumn),\n        options // detect changes for all options except bounds, but pass them all!\n      );\n    }\n  }, [map, geoJson, data.rows, optionsWithoutBounds]); // eslint-disable-line react-hooks/exhaustive-deps\n\n  // This may come only from editor\n  useEffect(() => {\n    if (map) {\n      // @ts-expect-error ts-migrate(2531) FIXME: Object is possibly 'null'.\n      map.updateBounds(options.bounds);\n    }\n  }, [map, options, onOptionsChange]);\n\n  return (\n    // @ts-expect-error ts-migrate(2322) FIXME: Type 'Dispatch<SetStateAction<null>>' is not assig... Remove this comment to see the full error message\n    <div className=\"map-visualization-container\" style={{ background: options.colors.background }} ref={setContainer} />\n  );\n}\n\nRenderer.propTypes = RendererPropTypes;\n"],"mappings":";;;;;;;;;;;AAAA,SAASA,IAAI,EAAEC,IAAI,QAAQ,QAAQ;AACnC,OAAOC,KAAK,IAAIC,QAAQ,EAAEC,SAAS,EAAEC,MAAM,QAAQ,OAAO;AAC1D,SAASC,iBAAiB;AAC1B,OAAOC,sBAAsB;AAE7B,OAAOC,cAAc;AACrB,OAAOC,cAAc;AACrB,SAASC,WAAW;AACpB;AAEA,eAAe,SAASC,QAAQA,CAAAC,IAAA,EAA0C;EAAA,IAAvCC,IAAI,GAAAD,IAAA,CAAJC,IAAI;IAAEC,OAAO,GAAAF,IAAA,CAAPE,OAAO;IAAEC,eAAe,GAAAH,IAAA,CAAfG,eAAe;EAC/D,IAAAC,SAAA,GAAkCb,QAAQ,CAAC,IAAI,CAAC;IAAAc,UAAA,GAAAC,cAAA,CAAAF,SAAA;IAAzCG,SAAS,GAAAF,UAAA;IAAEG,YAAY,GAAAH,UAAA;EAC9B,IAAAI,eAAA,GAAkBb,cAAc,CAACM,OAAO,CAACQ,OAAO,CAAC;IAAAC,gBAAA,GAAAL,cAAA,CAAAG,eAAA;IAA1CG,OAAO,GAAAD,gBAAA;EACd,IAAME,iBAAiB,GAAGpB,MAAM,CAAC,CAAC;EAClC;EACAoB,iBAAiB,CAACC,OAAO,GAAGX,eAAe,GAAIY,MAAW,IAAKZ,eAAe,CAAAa,aAAA,CAAAA,aAAA,KAAMd,OAAO;IAAEa;EAAM,EAAE,CAAC,GAAG1B,IAAI;EAE7G,IAAM4B,oBAAoB,GAAGtB,sBAAsB,CAAC,MAAMP,IAAI,CAACc,OAAO,EAAE,CAAC,QAAQ,CAAC,CAAC,EAAE,CAACA,OAAO,CAAC,CAAC;EAE/F,IAAAgB,UAAA,GAAsB3B,QAAQ,CAAC,IAAI,CAAC;IAAA4B,UAAA,GAAAb,cAAA,CAAAY,UAAA;IAA7BE,GAAG,GAAAD,UAAA;IAAEE,MAAM,GAAAF,UAAA;EAElB3B,SAAS,CAAC,MAAM;IACd,IAAIe,SAAS,EAAE;MACb;MACA,IAAMe,IAAI,GAAGzB,cAAc,CAACU,SAAS,EAAE;QAAA,OAAaM,iBAAiB,CAACC,OAAO,CAAC,GAAAS,SAAO,CAAC;MAAA,EAAC;MACvF;MACAF,MAAM,CAACC,IAAI,CAAC;MACZ,OAAO,MAAM;QACXA,IAAI,CAACE,OAAO,CAAC,CAAC;MAChB,CAAC;IACH;EACF,CAAC,EAAE,CAACjB,SAAS,CAAC,CAAC;EAEff,SAAS,CAAC,MAAM;IACd,IAAI4B,GAAG,EAAE;MACP;MACAA,GAAG,CAACK,YAAY,CACdb,OAAO;MACP;MACAd,WAAW,CAACG,IAAI,CAACyB,IAAI,EAAET,oBAAoB,CAACU,SAAS,EAAEV,oBAAoB,CAACW,WAAW,CAAC,EACxF1B,OAAO,CAAC;MACV,CAAC;IACH;EACF,CAAC,EAAE,CAACkB,GAAG,EAAER,OAAO,EAAEX,IAAI,CAACyB,IAAI,EAAET,oBAAoB,CAAC,CAAC,CAAC,CAAC;;EAErD;EACAzB,SAAS,CAAC,MAAM;IACd,IAAI4B,GAAG,EAAE;MACP;MACAA,GAAG,CAACS,YAAY,CAAC3B,OAAO,CAACa,MAAM,CAAC;IAClC;EACF,CAAC,EAAE,CAACK,GAAG,EAAElB,OAAO,EAAEC,eAAe,CAAC,CAAC;EAEnC;IAAA;IACE;IACAb,KAAA,CAAAwC,aAAA;MAAKC,SAAS,EAAC,6BAA6B;MAACC,KAAK,EAAE;QAAEC,UAAU,EAAE/B,OAAO,CAACgC,MAAM,CAACD;MAAW,CAAE;MAACE,GAAG,EAAE3B;IAAa,CAAE;EAAC;AAExH;AAEAT,QAAQ,CAACqC,SAAS,GAAG1C,iBAAiB"}