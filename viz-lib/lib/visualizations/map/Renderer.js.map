{"version":3,"file":"Renderer.js","names":["isEqual","omit","merge","React","useState","useEffect","useRef","useMemo","RendererPropTypes","prepareData","initMap","useMemoWithDeepCompare","create","inputs","valueRef","value","current","Renderer","_ref","data","options","onOptionsChange","_useState","_useState2","_slicedToArray","container","setContainer","optionsWithoutBounds","groups","_useState3","_useState4","map","setMap","_map","destroy","updateLayers","updateBounds","bounds","onBoundsChange","createElement","className","ref","propTypes"],"sources":["../../../src/visualizations/map/Renderer.tsx"],"sourcesContent":["import { isEqual, omit, merge } from \"lodash\";\nimport React, { useState, useEffect, useRef, useMemo } from \"react\";\nimport { RendererPropTypes } from \"@/visualizations/prop-types\";\n\nimport prepareData from \"./prepareData\";\nimport initMap from \"./initMap\";\n\nfunction useMemoWithDeepCompare(create: any, inputs: any) {\n  const valueRef = useRef();\n  const value = useMemo(create, inputs);\n  if (!isEqual(value, valueRef.current)) {\n    // @ts-expect-error ts-migrate(2322) FIXME: Type 'unknown' is not assignable to type 'undefine... Remove this comment to see the full error message\n    valueRef.current = value;\n  }\n  return valueRef.current;\n}\n\nexport default function Renderer({ data, options, onOptionsChange }: any) {\n  const [container, setContainer] = useState(null);\n\n  const optionsWithoutBounds = useMemoWithDeepCompare(() => omit(options, [\"bounds\"]), [options]);\n\n  const groups = useMemo(() => prepareData(data, optionsWithoutBounds), [data, optionsWithoutBounds]);\n\n  const [map, setMap] = useState(null);\n\n  useEffect(() => {\n    if (container) {\n      const _map = initMap(container);\n      // @ts-expect-error ts-migrate(2345) FIXME: Argument of type '{ onBoundsChange: () => void; up... Remove this comment to see the full error message\n      setMap(_map);\n      return () => {\n        _map.destroy();\n      };\n    }\n  }, [container]);\n\n  useEffect(() => {\n    if (map) {\n      // @ts-expect-error ts-migrate(2531) FIXME: Object is possibly 'null'.\n      map.updateLayers(groups, optionsWithoutBounds);\n    }\n  }, [map, groups, optionsWithoutBounds]);\n\n  useEffect(() => {\n    if (map) {\n      // @ts-expect-error ts-migrate(2531) FIXME: Object is possibly 'null'.\n      map.updateBounds(options.bounds);\n    }\n  }, [map, options.bounds]);\n\n  useEffect(() => {\n    if (map && onOptionsChange) {\n      // @ts-expect-error ts-migrate(2531) FIXME: Object is possibly 'null'.\n      map.onBoundsChange = (bounds: any) => {\n        onOptionsChange(merge({}, options, { bounds }));\n      };\n    }\n  }, [map, options, onOptionsChange]);\n\n  // @ts-expect-error ts-migrate(2322) FIXME: Type 'Dispatch<SetStateAction<null>>' is not assig... Remove this comment to see the full error message\n  return <div className=\"map-visualization-container\" ref={setContainer} />;\n}\n\nRenderer.propTypes = RendererPropTypes;\n"],"mappings":";;;;;;AAAA,SAASA,OAAO,EAAEC,IAAI,EAAEC,KAAK,QAAQ,QAAQ;AAC7C,OAAOC,KAAK,IAAIC,QAAQ,EAAEC,SAAS,EAAEC,MAAM,EAAEC,OAAO,QAAQ,OAAO;AACnE,SAASC,iBAAiB;AAE1B,OAAOC,WAAW;AAClB,OAAOC,OAAO;AAEd,SAASC,sBAAsBA,CAACC,MAAW,EAAEC,MAAW,EAAE;EACxD,IAAMC,QAAQ,GAAGR,MAAM,CAAC,CAAC;EACzB,IAAMS,KAAK,GAAGR,OAAO,CAACK,MAAM,EAAEC,MAAM,CAAC;EACrC,IAAI,CAACb,OAAO,CAACe,KAAK,EAAED,QAAQ,CAACE,OAAO,CAAC,EAAE;IACrC;IACAF,QAAQ,CAACE,OAAO,GAAGD,KAAK;EAC1B;EACA,OAAOD,QAAQ,CAACE,OAAO;AACzB;AAEA,eAAe,SAASC,QAAQA,CAAAC,IAAA,EAA0C;EAAA,IAAvCC,IAAI,GAAAD,IAAA,CAAJC,IAAI;IAAEC,OAAO,GAAAF,IAAA,CAAPE,OAAO;IAAEC,eAAe,GAAAH,IAAA,CAAfG,eAAe;EAC/D,IAAAC,SAAA,GAAkClB,QAAQ,CAAC,IAAI,CAAC;IAAAmB,UAAA,GAAAC,cAAA,CAAAF,SAAA;IAAzCG,SAAS,GAAAF,UAAA;IAAEG,YAAY,GAAAH,UAAA;EAE9B,IAAMI,oBAAoB,GAAGhB,sBAAsB,CAAC,MAAMV,IAAI,CAACmB,OAAO,EAAE,CAAC,QAAQ,CAAC,CAAC,EAAE,CAACA,OAAO,CAAC,CAAC;EAE/F,IAAMQ,MAAM,GAAGrB,OAAO,CAAC,MAAME,WAAW,CAACU,IAAI,EAAEQ,oBAAoB,CAAC,EAAE,CAACR,IAAI,EAAEQ,oBAAoB,CAAC,CAAC;EAEnG,IAAAE,UAAA,GAAsBzB,QAAQ,CAAC,IAAI,CAAC;IAAA0B,UAAA,GAAAN,cAAA,CAAAK,UAAA;IAA7BE,GAAG,GAAAD,UAAA;IAAEE,MAAM,GAAAF,UAAA;EAElBzB,SAAS,CAAC,MAAM;IACd,IAAIoB,SAAS,EAAE;MACb,IAAMQ,IAAI,GAAGvB,OAAO,CAACe,SAAS,CAAC;MAC/B;MACAO,MAAM,CAACC,IAAI,CAAC;MACZ,OAAO,MAAM;QACXA,IAAI,CAACC,OAAO,CAAC,CAAC;MAChB,CAAC;IACH;EACF,CAAC,EAAE,CAACT,SAAS,CAAC,CAAC;EAEfpB,SAAS,CAAC,MAAM;IACd,IAAI0B,GAAG,EAAE;MACP;MACAA,GAAG,CAACI,YAAY,CAACP,MAAM,EAAED,oBAAoB,CAAC;IAChD;EACF,CAAC,EAAE,CAACI,GAAG,EAAEH,MAAM,EAAED,oBAAoB,CAAC,CAAC;EAEvCtB,SAAS,CAAC,MAAM;IACd,IAAI0B,GAAG,EAAE;MACP;MACAA,GAAG,CAACK,YAAY,CAAChB,OAAO,CAACiB,MAAM,CAAC;IAClC;EACF,CAAC,EAAE,CAACN,GAAG,EAAEX,OAAO,CAACiB,MAAM,CAAC,CAAC;EAEzBhC,SAAS,CAAC,MAAM;IACd,IAAI0B,GAAG,IAAIV,eAAe,EAAE;MAC1B;MACAU,GAAG,CAACO,cAAc,GAAID,MAAW,IAAK;QACpChB,eAAe,CAACnB,KAAK,CAAC,CAAC,CAAC,EAAEkB,OAAO,EAAE;UAAEiB;QAAO,CAAC,CAAC,CAAC;MACjD,CAAC;IACH;EACF,CAAC,EAAE,CAACN,GAAG,EAAEX,OAAO,EAAEC,eAAe,CAAC,CAAC;;EAEnC;EACA,oBAAOlB,KAAA,CAAAoC,aAAA;IAAKC,SAAS,EAAC,6BAA6B;IAACC,GAAG,EAAEf;EAAa,CAAE,CAAC;AAC3E;AAEAT,QAAQ,CAACyB,SAAS,GAAGlC,iBAAiB"}