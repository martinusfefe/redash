{"version":3,"file":"initMap.js","names":["isFunction","each","map","toString","clone","chroma","L","markerIcon","markerIconRetina","markerShadow","formatSimpleTemplate","sanitize","resizeObserver","chooseTextColorForBackground","Icon","Default","mergeOptions","iconUrl","iconRetinaUrl","shadowUrl","prototype","_getIconUrl","iconAnchors","marker","circle","rectangle","doughnut","popupAnchors","createHeatpointMarker","lat","lon","color","circleMarker","fillColor","fillOpacity","stroke","MarkerClusterIcon","DivIcon","extend","options","className","iconSize","Point","createIcon","textColor","borderColor","alpha","css","backgroundColor","_len","arguments","length","args","Array","_key","icon","call","innerHTML","concat","html","style","background","markerClusterIcon","_len2","_key2","createIconMarker","_ref","iconShape","iconFont","foregroundColor","BeautifyIcon","iconAnchor","popupAnchor","prefix","createMarkerClusterGroup","markerClusterGroup","iconCreateFunction","cluster","getChildCount","createMarkersLayer","_ref2","points","classify","clusterMarkers","customizeMarkers","result","featureGroup","_ref3","row","rowCopy","latColName","lonColName","tooltip","enabled","template","bindTooltip","popup","bindPopup","v","k","join","addLayer","initMap","container","_map","center","zoom","scrollWheelZoom","fullscreenControl","_tileLayer","tileLayer","attribution","addTo","_markerLayers","_layersControls","control","layers","onBoundsChange","boundsChangedFromMap","onMapMoveEnd","getBounds","on","off","updateLayers","groups","setUrl","mapTileUrl","eachLayer","layer","removeLayer","group","addOverlay","name","remove","updateBounds","bounds","latLngBounds","_southWest","lng","_northEast","isValid","fitBounds","animate","duration","unwatchResize","invalidateSize","value","destroy"],"sources":["../../../src/visualizations/map/initMap.ts"],"sourcesContent":["import { isFunction, each, map, toString, clone } from \"lodash\";\nimport chroma from \"chroma-js\";\nimport L from \"leaflet\";\nimport \"leaflet.markercluster\";\nimport \"leaflet/dist/leaflet.css\";\nimport \"leaflet.markercluster/dist/MarkerCluster.css\";\nimport \"leaflet.markercluster/dist/MarkerCluster.Default.css\";\nimport \"beautifymarker\";\nimport \"beautifymarker/leaflet-beautify-marker-icon.css\";\n// @ts-expect-error ts-migrate(2307) FIXME: Cannot find module 'leaflet/dist/images/marker-ico... Remove this comment to see the full error message\nimport markerIcon from \"leaflet/dist/images/marker-icon.png\";\n// @ts-expect-error ts-migrate(2307) FIXME: Cannot find module 'leaflet/dist/images/marker-ico... Remove this comment to see the full error message\nimport markerIconRetina from \"leaflet/dist/images/marker-icon-2x.png\";\n// @ts-expect-error ts-migrate(2307) FIXME: Cannot find module 'leaflet/dist/images/marker-sha... Remove this comment to see the full error message\nimport markerShadow from \"leaflet/dist/images/marker-shadow.png\";\nimport \"leaflet-fullscreen\";\nimport \"leaflet-fullscreen/dist/leaflet.fullscreen.css\";\nimport { formatSimpleTemplate } from \"@/lib/value-format\";\nimport sanitize from \"@/services/sanitize\";\nimport resizeObserver from \"@/services/resizeObserver\";\nimport chooseTextColorForBackground from \"@/lib/chooseTextColorForBackground\";\n\n// This is a workaround for an issue with giving Leaflet load the icon on its own.\nL.Icon.Default.mergeOptions({\n  iconUrl: markerIcon,\n  iconRetinaUrl: markerIconRetina,\n  shadowUrl: markerShadow,\n});\n\n// @ts-expect-error ts-migrate(2339) FIXME: Property '_getIconUrl' does not exist on type 'Def... Remove this comment to see the full error message\ndelete L.Icon.Default.prototype._getIconUrl;\n\nconst iconAnchors = {\n  marker: [14, 32],\n  circle: [10, 10],\n  rectangle: [11, 11],\n  \"circle-dot\": [1, 2],\n  \"rectangle-dot\": [1, 2],\n  doughnut: [8, 8],\n};\n\nconst popupAnchors = {\n  rectangle: [0, -3],\n  circle: [1, -3],\n};\n\nconst createHeatpointMarker = (lat: any, lon: any, color: any) =>\n  L.circleMarker([lat, lon], { fillColor: color, fillOpacity: 0.9, stroke: false });\n\n// @ts-expect-error ts-migrate(2339) FIXME: Property 'MarkerClusterIcon' does not exist on typ... Remove this comment to see the full error message\nL.MarkerClusterIcon = L.DivIcon.extend({\n  options: {\n    color: null,\n    className: \"marker-cluster\",\n    iconSize: new L.Point(40, 40),\n  },\n  // @ts-expect-error ts-migrate(7019) FIXME: Rest parameter 'args' implicitly has an 'any[]' ty... Remove this comment to see the full error message\n  createIcon(...args) {\n    const color = chroma(this.options.color);\n    const textColor = chooseTextColorForBackground(color);\n    const borderColor = color.alpha(0.4).css();\n    const backgroundColor = color.alpha(0.8).css();\n\n    const icon = L.DivIcon.prototype.createIcon.call(this, ...args);\n    icon.innerHTML = `\n      <div style=\"background: ${backgroundColor}\">\n        <span style=\"color: ${textColor}\">${toString(this.options.html)}</span>\n      </div>\n    `;\n    icon.style.background = borderColor;\n    return icon;\n  },\n});\n// @ts-expect-error ts-migrate(2339) FIXME: Property 'markerClusterIcon' does not exist on typ... Remove this comment to see the full error message\nL.markerClusterIcon = (...args) => new L.MarkerClusterIcon(...args);\n\nfunction createIconMarker(\n  lat: any,\n  lon: any,\n  { iconShape, iconFont, foregroundColor, backgroundColor, borderColor }: any\n) {\n  // @ts-expect-error ts-migrate(2339) FIXME: Property 'BeautifyIcon' does not exist on type 'ty... Remove this comment to see the full error message\n  const icon = L.BeautifyIcon.icon({\n    iconShape,\n    icon: iconFont,\n    iconSize: iconShape === \"rectangle\" ? [22, 22] : false,\n    // @ts-expect-error ts-migrate(7053) FIXME: Element implicitly has an 'any' type because expre... Remove this comment to see the full error message\n    iconAnchor: iconAnchors[iconShape],\n    // @ts-expect-error ts-migrate(7053) FIXME: Element implicitly has an 'any' type because expre... Remove this comment to see the full error message\n    popupAnchor: popupAnchors[iconShape],\n    prefix: \"fa\",\n    textColor: foregroundColor,\n    backgroundColor,\n    borderColor,\n  });\n\n  return L.marker([lat, lon], { icon });\n}\n\nfunction createMarkerClusterGroup(color: any) {\n  // @ts-expect-error ts-migrate(2339) FIXME: Property 'markerClusterGroup' does not exist on ty... Remove this comment to see the full error message\n  return L.markerClusterGroup({\n    iconCreateFunction(cluster: any) {\n      // @ts-expect-error ts-migrate(2339) FIXME: Property 'markerClusterIcon' does not exist on typ... Remove this comment to see the full error message\n      return L.markerClusterIcon({ color, html: cluster.getChildCount() });\n    },\n  });\n}\n\nfunction createMarkersLayer(options: any, { color, points }: any) {\n  const { classify, clusterMarkers, customizeMarkers } = options;\n\n  const result = clusterMarkers ? createMarkerClusterGroup(color) : L.featureGroup();\n\n  // create markers\n  each(points, ({ lat, lon, row }) => {\n    const rowCopy = clone(row);\n    rowCopy[options.latColName] = lat;\n    rowCopy[options.lonColName] = lon;\n\n    let marker;\n    if (classify) {\n      marker = createHeatpointMarker(lat, lon, color);\n    } else {\n      if (customizeMarkers) {\n        marker = createIconMarker(lat, lon, options);\n      } else {\n        marker = L.marker([lat, lon]);\n      }\n    }\n\n    if (options.tooltip.enabled) {\n      if (options.tooltip.template !== \"\") {\n        marker.bindTooltip(sanitize(formatSimpleTemplate(options.tooltip.template, rowCopy)));\n      } else {\n        marker.bindTooltip(`\n          <strong>${lat}, ${lon}</strong>\n        `);\n      }\n    }\n\n    if (options.popup.enabled) {\n      if (options.popup.template !== \"\") {\n        marker.bindPopup(sanitize(formatSimpleTemplate(options.popup.template, rowCopy)));\n      } else {\n        marker.bindPopup(`\n          <ul style=\"list-style-type: none; padding-left: 0\">\n            <li><strong>${lat}, ${lon}</strong>\n            ${map(row, (v, k) => `<li>${k}: ${v}</li>`).join(\"\")}\n          </ul>\n        `);\n      }\n    }\n    result.addLayer(marker);\n  });\n\n  return result;\n}\n\nexport default function initMap(container: any) {\n  const _map = L.map(container, {\n    center: [0.0, 0.0],\n    zoom: 1,\n    scrollWheelZoom: false,\n    // @ts-expect-error ts-migrate(2345) FIXME: Argument of type '{ center: [number, number]; zoom... Remove this comment to see the full error message\n    fullscreenControl: true,\n  });\n  const _tileLayer = L.tileLayer(\"//{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\", {\n    attribution: '&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors',\n  }).addTo(_map);\n  const _markerLayers = L.featureGroup().addTo(_map);\n  const _layersControls = L.control.layers().addTo(_map);\n\n  let onBoundsChange = () => {};\n\n  let boundsChangedFromMap = false;\n  const onMapMoveEnd = () => {\n    // @ts-expect-error ts-migrate(2554) FIXME: Expected 0 arguments, but got 1.\n    onBoundsChange(_map.getBounds());\n  };\n  _map.on(\"focus\", () => {\n    boundsChangedFromMap = true;\n    _map.on(\"moveend\", onMapMoveEnd);\n  });\n  _map.on(\"blur\", () => {\n    _map.off(\"moveend\", onMapMoveEnd);\n    boundsChangedFromMap = false;\n  });\n\n  function updateLayers(groups: any, options: any) {\n    _tileLayer.setUrl(options.mapTileUrl);\n\n    _markerLayers.eachLayer(layer => {\n      _markerLayers.removeLayer(layer);\n      _layersControls.removeLayer(layer);\n    });\n\n    each(groups, group => {\n      const layer = createMarkersLayer(options, group);\n      _markerLayers.addLayer(layer);\n      _layersControls.addOverlay(layer, group.name);\n    });\n\n    // hide layers control if it is empty\n    if (groups.length > 0) {\n      _layersControls.addTo(_map);\n    } else {\n      _layersControls.remove();\n    }\n  }\n\n  function updateBounds(bounds: any) {\n    if (!boundsChangedFromMap) {\n      bounds = bounds\n        ? L.latLngBounds([bounds._southWest.lat, bounds._southWest.lng], [bounds._northEast.lat, bounds._northEast.lng])\n        : _markerLayers.getBounds();\n      if (bounds.isValid()) {\n        _map.fitBounds(bounds, { animate: false, duration: 0 });\n      }\n    }\n  }\n\n  const unwatchResize = resizeObserver(container, () => {\n    _map.invalidateSize(false);\n  });\n\n  return {\n    get onBoundsChange() {\n      return onBoundsChange;\n    },\n    set onBoundsChange(value) {\n      onBoundsChange = isFunction(value) ? value : () => {};\n    },\n    updateLayers,\n    updateBounds,\n    destroy() {\n      unwatchResize();\n      _map.remove();\n    },\n  };\n}\n"],"mappings":"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"}