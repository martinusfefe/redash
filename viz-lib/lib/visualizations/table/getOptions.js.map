{"version":3,"file":"getOptions.js","names":["_","visualizationsSettings","DEFAULT_OPTIONS","itemsPerPage","paginationSize","filterTypes","getColumnNameWithoutType","column","typeSplit","indexOf","parts","split","length","includes","getColumnContentAlignment","type","getDefaultColumnsOptions","columns","displayAs","integer","float","boolean","date","datetime","map","col","index","name","visible","order","title","allowSearch","alignContent","allowHTML","highlightLinks","getDefaultFormatOptions","dateTimeFormat","dateFormat","numberFormat","integerFormat","floatFormat","nullValue","booleanValues","imageUrlTemplate","imageTitleTemplate","imageWidth","imageHeight","linkUrlTemplate","linkTextTemplate","linkTitleTemplate","linkOpenInNewTab","wereColumnsReordered","queryColumns","visualizationColumns","filter","i","getColumnsOptions","options","fromPairs","extend","omit","each","sortBy","getOptions","_ref","_objectSpread"],"sources":["../../../src/visualizations/table/getOptions.ts"],"sourcesContent":["import _ from \"lodash\";\nimport { visualizationsSettings } from \"@/visualizations/visualizationsSettings\";\n\nconst DEFAULT_OPTIONS = {\n  itemsPerPage: 25,\n  paginationSize: \"default\", // not editable through Editor\n};\n\nconst filterTypes = [\"filter\", \"multi-filter\", \"multiFilter\"];\n\nfunction getColumnNameWithoutType(column: any) {\n  let typeSplit;\n  if (column.indexOf(\"::\") !== -1) {\n    typeSplit = \"::\";\n  } else if (column.indexOf(\"__\") !== -1) {\n    typeSplit = \"__\";\n  } else {\n    return column;\n  }\n\n  const parts = column.split(typeSplit);\n  if (parts[0] === \"\" && parts.length === 2) {\n    return parts[1];\n  }\n\n  if (!_.includes(filterTypes, parts[1])) {\n    return column;\n  }\n\n  return parts[0];\n}\n\nfunction getColumnContentAlignment(type: any) {\n  return [\"integer\", \"float\", \"boolean\", \"date\", \"datetime\"].indexOf(type) >= 0 ? \"right\" : \"left\";\n}\n\nfunction getDefaultColumnsOptions(columns: any) {\n  const displayAs = {\n    integer: \"number\",\n    float: \"number\",\n    boolean: \"boolean\",\n    date: \"datetime\",\n    datetime: \"datetime\",\n  };\n\n  return _.map(columns, (col, index) => ({\n    name: col.name,\n    type: col.type,\n    // @ts-expect-error ts-migrate(7053) FIXME: Element implicitly has an 'any' type because expre... Remove this comment to see the full error message\n    displayAs: displayAs[col.type] || \"string\",\n    visible: true,\n    order: 100000 + index,\n    title: getColumnNameWithoutType(col.name),\n    allowSearch: false,\n    alignContent: getColumnContentAlignment(col.type),\n    // `string` cell options\n    allowHTML: false,\n    highlightLinks: false,\n  }));\n}\n\nfunction getDefaultFormatOptions(column: any) {\n  const dateTimeFormat = {\n    date: visualizationsSettings.dateFormat || \"DD/MM/YYYY\",\n    datetime: visualizationsSettings.dateTimeFormat || \"DD/MM/YYYY HH:mm\",\n  };\n  const numberFormat = {\n    integer: visualizationsSettings.integerFormat || \"0,0\",\n    float: visualizationsSettings.floatFormat || \"0,0.00\",\n  };\n  return {\n    // @ts-expect-error ts-migrate(7053) FIXME: Element implicitly has an 'any' type because expre... Remove this comment to see the full error message\n    dateTimeFormat: dateTimeFormat[column.type],\n    // @ts-expect-error ts-migrate(7053) FIXME: Element implicitly has an 'any' type because expre... Remove this comment to see the full error message\n    numberFormat: numberFormat[column.type],\n    nullValue: visualizationsSettings.nullValue,\n    booleanValues: visualizationsSettings.booleanValues || [\"false\", \"true\"],\n    // `image` cell options\n    imageUrlTemplate: \"{{ @ }}\",\n    imageTitleTemplate: \"{{ @ }}\",\n    imageWidth: \"\",\n    imageHeight: \"\",\n    // `link` cell options\n    linkUrlTemplate: \"{{ @ }}\",\n    linkTextTemplate: \"{{ @ }}\",\n    linkTitleTemplate: \"{{ @ }}\",\n    linkOpenInNewTab: true,\n  };\n}\n\nfunction wereColumnsReordered(queryColumns: any, visualizationColumns: any) {\n  queryColumns = _.map(queryColumns, col => col.name);\n  visualizationColumns = _.map(visualizationColumns, col => col.name);\n\n  // Some columns may be removed - so skip them (but keep original order)\n  visualizationColumns = _.filter(visualizationColumns, col => _.includes(queryColumns, col));\n  // Pick query columns that were previously saved with viz (but keep order too)\n  queryColumns = _.filter(queryColumns, col => _.includes(visualizationColumns, col));\n\n  // Both array now have the same size as they both contains only common columns\n  // (in fact, it was an intersection, that kept order of items on both arrays).\n  // Now check for equality item-by-item; if common columns are in the same order -\n  // they were not reordered in editor\n  for (let i = 0; i < queryColumns.length; i += 1) {\n    if (visualizationColumns[i] !== queryColumns[i]) {\n      return true;\n    }\n  }\n  return false;\n}\n\nfunction getColumnsOptions(columns: any, visualizationColumns: any) {\n  const options = getDefaultColumnsOptions(columns);\n\n  if (wereColumnsReordered(columns, visualizationColumns)) {\n    visualizationColumns = _.fromPairs(\n      _.map(visualizationColumns, (col, index) => [col.name, _.extend({}, col, { order: index })])\n    );\n  } else {\n    visualizationColumns = _.fromPairs(_.map(visualizationColumns, col => [col.name, _.omit(col, \"order\")]));\n  }\n\n  _.each(options, col => _.extend(col, visualizationColumns[col.name]));\n\n  return _.sortBy(options, \"order\");\n}\n\nexport default function getOptions(options: any, { columns }: any) {\n  options = { ...DEFAULT_OPTIONS, ...options };\n  options.columns = _.map(getColumnsOptions(columns, options.columns), col => ({\n    ...getDefaultFormatOptions(col),\n    ...col,\n  }));\n  return options;\n}\n"],"mappings":"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"}